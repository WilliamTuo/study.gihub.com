<html>
<head>
  <title>Linux 升级 gcc/g++</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600240 (zh-CN, DDL); Windows/6.1.1 (Win32);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1709"/>
<h1>Linux 升级 gcc/g++</h1>

<div>
<span><div><div><span style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);-en-paragraph:true;">首先升级gcc和g++是没有便捷方式的，例如像yum update ....  yum install  这些命令都是没用的，或者添加yum的repo文件也是不行的，所以我们只能手动编译安装了，下面就开始我们的安装过程。</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>1、获取安装包并解压</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">wget <a href="http://ftp.gnu.org/gnu/gcc/gcc-6.1.0/gcc-6.1.0.tar.bz2">http://ftp.gnu.org/gnu/gcc/gcc-6.1.0/gcc-6.1.0.tar.bz2</a></span></div><div style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252); margin-top: 1em; margin-bottom: 1em;"><span style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);-en-paragraph:true;">tar -jxvf gcc-6.1.0.tar.bz2当然，</span><a href="http://ftp.gnu.org/gnu/gcc" style="color: rgb(179, 43, 213); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252); text-decoration: underline;-en-paragraph:true;">http://ftp.gnu.org/gnu/gcc</a><span style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);-en-paragraph:true;"> </span><span style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);-en-paragraph:true;">里面有所有的gcc版本可供下载，最新的版本已经更新到7.1.0，但是我们并不需要最新版本，下面就用6.1.0版本来操作，其他的版本都可类似操作。</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>2、下载供编译需求的依赖项</div><div>这个神奇的脚本文件会帮我们下载、配置、安装依赖库，可以节约我们大量的时间和精力。</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">cd gcc-6.1.0</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>./contrib/download_prerequisites</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">运行这个脚本要在联网状态下完成，因为要下载配置，安装依赖库，这也需要时间，网络不好的时候会是一个较慢长的等待时间。</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>3、建立一个目录供编译出的文件存放</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">mkdir gcc-build-6.1.0</span></div><div style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252); margin-top: 1em; margin-bottom: 1em;"><span style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);-en-paragraph:true;">cd gcc-build-6.1.0</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>4、生成Makefile文件</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">../configure -enable-checking=release -enable-languages=c,c++ -disable-multilib</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>5、编译</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">make -j4</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>-j4选项是make对多核处理器的优化，如果不成功请使用make</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">（注意：此步骤非常耗时,我虚拟机耗时近3小时; 实体机近80分钟,CPU基本是满的,内存也使用不少）</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>6、安装</div><div>make install（安装需要root权限）</div><div>查看安装</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">ls /usr/local/bin | grep gcc</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>7、重启然后查看gcc版本</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">gcc -v</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>8、这之后你就可以写个C++11的程序段进行测试</div><div>代码在此处省略。。。。。。</div><div>g++ -std=c++0x -o demoCpp11 demoCpp11.cpp</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">通过上面的步骤就可以完成对g++和gcc的升级</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div><span style="font-weight: bold;">下面我们来解决开头提到的问题：</span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">源码编译升级安装了gcc后，编译程序或运行其它程序时，有时会出现类似/usr/lib64/libstdc++.so.6: version `GLIBCXX_3.4.14' not found的问题。这是因为升级gcc时，生成的动态库没有替换老版本gcc的动态库导致的，将gcc最新版本的动态库替换系统中老版本的动态库即可解决。</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>(1). 运行以下命令检查动态库：</div><div>strings /usr/lib64/libstdc++.so.6 | grep GLIBC</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">从输出可以看出，gcc的动态库还是旧版本的。说明出现这些问题，是因为升级gcc时，生成的动态库没有替换老版本gcc的动态库。</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>(2). 执行以下命令，查找编译gcc时生成的最新动态库：</div><div>find / -name &quot;libstdc++.so*&quot;</div><div>将上面的最新动态库libstdc++.so.6.0.22复制到/usr/lib64目录下</div><div>cd /usr/lib64</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">cp /root/Downloads/gcc-6.1.0/gcc-build-6.1.0/stage1-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.22  ./</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>(3). 删除原来软连接：</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">rm -rf libstdc++.so.6</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>(4). 将默认库的软连接指向最新动态库：</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">ln -s libstdc++.so.6.0.22 libstdc++.so.6</span></div><p style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);"></p><div>(5). 默认动态库升级完成。重新运行以下命令检查动态库：</div><div>strings /usr/lib64/libstdc++.so.6 | grep GLIBC</div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;">可以看到 输出有&quot;GLIBCXX_3.4.14&quot; 了</span></div><div><span style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);-en-paragraph:true;">注意：网上的有一些教程在解决这个问题的时候会有这种方法，就是在网上找一个 libstdc++.so.6.0.22，然后使用这个来生成软连接，这样是不行的，一定要用自己编译的动态库，否则当你重启电脑的时候，你的</span><a href="https://www.linuxidc.com/topicnews.aspx?tid=14" style="color: rgb(179, 43, 213); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252); text-decoration: underline;-en-paragraph:true;" title="CentOS">CentOS</a><span style="color: rgb(51, 51, 51); font-family: tahoma, 宋体; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(250, 250, 252);-en-paragraph:true;">桌面系统就会出问题，图形化界面都无法操作，就是因为你使用了一个来路不明的动态库导致的，解决办法就是使用自己编译的动态库或者系统自带的动态库来生成软连接，这样重启之后系统就会恢复了。</span></div></div></span>
</div></body></html> 